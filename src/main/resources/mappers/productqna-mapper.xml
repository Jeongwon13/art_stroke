<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="productQnAMapper">


 	<!-- 제품 qna 조회 -->
	<resultMap type="productQna" id="productQna_rm">
		<id property="productId" column="PRODUCT_ID"/>
		<result property="qnaId" 		column="QNA_ID"/>
		<result property="qnaTitle"	 	column="QNA_TITLE"/>
		<result property="qnaContent" 		column="QNA_CONTENT"/>
		<result property="qnaRdate" 		column="QNA_RDATE"/>
		<result property="memberId" 			column="MEMBER_ID"/>
		<result property="memberNick" 			column="MEMBER_NICK"/>
		<result property="qnaPw" 			column="QNA_PW"/>
		<result property="qnaCheck" 			column="QNA_CHECK"/>
		<result property="productId" 			column="PRODUCT_ID"/>
		<result property="productImage" 			column="PRODUCT_IMAGE"/>
	</resultMap>
	
	
	<!-- qna 목록용 resultMap -->
	<resultMap type="productQnaList" id="productQnaList_rm">
		<id property="boardNo" column="QNA_ID" />
		<result property="qnaSecrePw" column="QNA_SECRETPW"/>		
		<result property="boardTitle" column="QNA_TITLE" />
		<result property="createDate" column="QNA_RDATE" />
		<result property="qnaCheck"   column="QNA_CHECK"/>		
		<result property="memberNickname" column="MEMBER_NICK" />
	</resultMap>




	<!-- qna 작성 -->  
	
	<insert id="insertProductQna" parameterType="productQna" useGeneratedKeys="true">
    <selectKey keyProperty="qnaId" resultType="_int" order="BEFORE">
        SELECT SEQ_QNA_NO.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO PRODUCT_QNA (PRODUCT_ID, QNA_ID, QNA_TITLE, QNA_CONTENT, QNA_RDATE, MEMBER_ID, QNA_PW, QNA_CHECK)
    VALUES (#{productId}, #{qnaId}, #{qnaTitle}, #{qnaContent}, #{qnaRdate}, #{memberId}, #{qnaPw}, #{qnaCheck})
	</insert>
	 
				
				
				
				
				
				
				
				
				
<!-- ********************************** 관리자 ****************************************  -->
	<!-- 관리자 페이지네이션 -->
	<select id="getAdminQnAListCount" resultType="_int">
	  SELECT COUNT(*) FROM PRODUCT_QNA
	 
	</select>
				
				
				
	<!-- 관리자 문의 -->
	<select id="selectAdminMemberQA" resultMap="productQna_rm">
		SELECT QNA_ID, QNA_TITLE, QNA_CONTENT,   QNA_CHECK, QNA_RDATE
		FROM PRODUCT_QNA
	</select>






	<!-- 관리자 문의 검색 -->		
	 <select id="searchAdminQnAListCount" resultType="int" parameterType="map">
		SELECT COUNT(*) 
		FROM PRODUCT_QNA
		
		WHERE
	 
		<if test='query != null and query != ""'>
			 
			<choose>
				<when test='key == "t"'> 
					QNA_TITLE LIKE '%' || #{query} || '%'
				</when>
				
				<when test='key == "c"'>
					QNA_CONTENT LIKE '%' || #{query} || '%'
				</when>
				
				<when test='key == "tc"'>
					( QNA_TITLE LIKE '%' || #{query} || '%'
					OR
					QNA_CONTENT LIKE '%' || #{query} || '%' )
				</when>
				
				 
			</choose>			
		</if>
		ORDER BY QNA_ID DESC
	</select>


	<!-- 관리자 문의 검색 -->
	<select id="searchAdminMemberQA" resultMap="productQna_rm">
	    SELECT QNA_ID, QNA_TITLE, QNA_CONTENT, QNA_CHECK 
	   
	    FROM PRODUCT_QNA
	   
	    WHERE
	    <!-- 검색어가 있을 경우 -->
	    <if test='query != null and query != ""'>
	      
	       	<choose>
				<when test='key == "t"'> 
					QNA_TITLE LIKE '%' || #{query} || '%'
				</when>
				
				<when test='key == "c"'>
					QNA_CONTENT LIKE '%' || #{query} || '%'
				</when>
				
				<when test='key == "tc"'>
					( QNA_TITLE LIKE '%' || #{query} || '%'
					OR
					QNA_CONTENT LIKE '%' || #{query} || '%' )
				</when>
				 
			</choose>			
	    </if> 
	    ORDER BY QNA_ID DESC 
	</select>    
		
	
	
	 




	<!-- 관리자 문의 처리 완료 시 -->
	<update id="updateAdminMemberQA" parameterType="java.util.Map">
	  UPDATE PRODUCT_QNA
	  SET QNA_CHECK = 1
	  WHERE QNA_ID IN
	  <foreach collection="selectedIds" item="qnaId" open="(" separator="," close=")">
	    ${qnaId}
	  </foreach>
	</update>
	
	
   
</mapper>
 	
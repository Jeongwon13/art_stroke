<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chattingMapper">

	<resultMap type="chatRoom" id="chatroom_rm">
		<id property="chatRoomId" column="CHAT_ROOM_ID" />
		<result property="chatStatus" column="CHAT_STATUS" />
		<result property="memberId" column="MEMBER_ID" />
		<result property="memberNick" column="MEMBER_NICK" />

	</resultMap>
	 
	<resultMap type="chatMessage" id="chatMessage_rm">
		<id property="chatMessageId" column="CHAT_MESSAGE_ID" />

		<result property="message" column="MESSAGE" />
		<result property="createRDate" column="CHAT_CREATE_DT" />
		<result property="chatRoomId" column="CHAT_ROOM_ID" />

		<result property="memberId" column="MEMBER_ID" />
		<result property="memberNick" column="MEMBER_NICK" />
	</resultMap>
 
 
	

	<!--========================================================================================= -->

	<!-- 채팅방 목록 조회 -->

	<select id="selectChatRoomList" resultMap="chatroom_rm">
		SELECT CHAT_ROOM_ID,
		MEMBER_NICK, MEMBER_ID
		FROM CHAT_ROOM
	
		ORDER BY CHAT_ROOM_ID DESC
	</select>

 	<!-- 채팅방 만들기 -->
	<insert id="openChatRoom" useGeneratedKeys="true">
	
		<selectKey keyProperty="chatRoomId" resultType="_int" order="BEFORE">
			SELECT SEQ_CHAT_NO.NEXTVAL FROM DUAL
		</selectKey>
		
		
			INSERT INTO CHAT_ROOM(CHAT_ROOM_ID, MEMBER_NICK, CHAT_STATUS, MEMBER_ID) VALUES
		(#{chatRoomId}, #{memberNick}, DEFAULT, #{memberId})
	</insert>
	
	
	<delete id="deleteChat" parameterType="java.util.Map">
		DELETE FROM CHAT_ROOM WHERE CHAT_ROOM_ID IN
		  <foreach collection="chatRoomChk" item="chatRoomId" open="(" separator="," close=")">
	    ${chatRoomId}
	  </foreach>
	</delete>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="replyMapper">
	<resultMap type="reply" id="reply_rm">
      <id property="replyId" column="REPLY_ID" />
      <result property ="replyContent" column="REPLY_CONTENT"/>
      <result property ="replyDt" column="REPLY_DT"/>
      <result property ="replyMemberId" column="REPLY_MEMBER_ID"/>
      <result property ="replyBoardNo" column="REPLY_BOARD_NO"/>
      <result property ="replyParentId" column="REPLY_PARENT_ID"/>
   </resultMap>
   
   <select id = "selectReplyList" resultMap ="reply_rm">
   SELECT LEVEL,  R.* FROM
		    (SELECT REPLY_ID, REPLY_CONTENT,
		        TO_CHAR(REPLY_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"') REPLY_DT,
		        REPLY_BOARD_NO, REPLY_MEMBER_ID, MEMBER_NICK, PROFILE_IMG, REPLY_PARENT_ID, REPLY_ST
		    FROM REPLY r
		    JOIN MEMBER m ON r.REPLY_MEMBER_ID = m.MEMBER_ID
		    WHERE REPLY_BOARD_NO = #{boardId}) R
		
		WHERE REPLY_ST = 'N'
		START WITH REPLY_PARENT_ID IS NULL
		CONNECT BY PRIOR REPLY_ID = REPLY_PARENT_ID
		ORDER SIBLINGS BY REPLY_ID
  </select>
</mapper>
